<!-- src/app/components/pedido-item/pedido-item-listar/pedido-item-listar.html -->

<div class="tc-page">
  <!-- HERO -->
  <section class="tc-hero">
    <div class="tc-hero-left">
      <div class="tc-hero-icon">
        <mat-icon>receipt_long</mat-icon>
      </div>

      <div>
        <h1 class="tc-hero-title">Ítems de pedido</h1>
        <p class="tc-hero-subtitle">
          Detalle de productos asociados a cada pedido.
        </p>
      </div>
    </div>

    <div class="tc-hero-right">
      <span class="tc-total">Total: {{ total || 0 }}</span>

      <button mat-raised-button class="tc-btn-primary" routerLink="/pedido-item/new">
        <mat-icon>add</mat-icon>
        Nuevo ítem
      </button>
    </div>
  </section>

  <!-- CARD CONTENEDOR -->
  <section class="tc-card">
    <div class="tc-card-top">
      <span class="tc-pill">Listado</span>
    </div>

    <div class="pedido-grid" *ngIf="items.length > 0; else sinRegistros">
      <!-- CARD POR CADA ITEM -->
      <mat-card
        class="pedido-card"
        appearance="outlined"
        *ngFor="let row of items"
      >
        <!-- Imagen superior -->
        <ng-container *ngIf="row.imagenUrl; else sinImagen">
          <div class="pedido-card-image">
            <img
              mat-card-image
              [src]="row.imagenUrl"
              alt="Imagen del producto"
            />
          </div>
        </ng-container>

        <ng-template #sinImagen>
          <div class="pedido-card-image pedido-card-image--placeholder">
            <mat-icon>image_not_supported</mat-icon>
          </div>
        </ng-template>

        <!-- Contenido inferior blanco -->
        <mat-card-content class="pedido-card-body">
          <h2 class="pedido-card-title">
            Pedido #{{ row.idPedido || '—' }}
          </h2>

          <p class="pedido-card-subtitle">
            {{ getNombreProducto(row) }}
          </p>

          <p class="pedido-card-price">
            S/
            {{
              (row.precioPedidoItem || 0) * (row.cantidadPedidoItem || 0)
                | number: '1.2-2'
            }}
          </p>

          <div class="pedido-card-info">
            <p><strong>Cantidad:</strong> {{ row.cantidadPedidoItem }}</p>
            <p>
              <strong>Precio unitario:</strong>
              S/
              {{ row.precioPedidoItem | number: '1.2-2' }}
            </p>
          </div>

          <div class="pedido-card-tags">
            <span class="tag tag-disponible">Disponible</span>
          </div>
        </mat-card-content>

        <!-- Acciones -->
        <mat-card-actions class="pedido-card-actions">
          <button
            mat-raised-button
            color="primary"
            [routerLink]="['/pedido-item/edit', row.idPedidoItem]"
          >
            <mat-icon>edit</mat-icon>
            Editar
          </button>

          <button
            mat-raised-button
            color="warn"
            (click)="eliminar(row.idPedidoItem)"
          >
            <mat-icon>delete</mat-icon>
            Eliminar
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <ng-template #sinRegistros>
      <div class="empty-state">
        <mat-icon>info</mat-icon>
        <p>No hay ítems de pedido registrados aún.</p>
      </div>
    </ng-template>
  </section>
</div>
