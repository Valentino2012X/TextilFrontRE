<div class="container">
  <h2>{{ edicion ? 'Editar calificación' : 'Nueva calificación' }}</h2>

  <form [formGroup]="form" (ngSubmit)="aceptar()">
    <div class="grid-2">
      <!-- Estrellas -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Estrellas*</mat-label>
        <input matInput type="number" formControlName="estrellas" />
        <mat-error *ngIf="f['estrellas'].hasError('required')">
          Las estrellas son obligatorias
        </mat-error>
        <mat-error *ngIf="f['estrellas'].hasError('min')">
          Mínimo 1 estrella
        </mat-error>
        <mat-error *ngIf="f['estrellas'].hasError('max')">
          Máximo 5 estrellas
        </mat-error>
      </mat-form-field>

      <!-- Fecha -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Fecha*</mat-label>
        <input
          matInput
          [matDatepicker]="pickerFecha"
          formControlName="fechaCalificacion"
        />
        <mat-datepicker-toggle
          matIconSuffix
          [for]="pickerFecha"
        ></mat-datepicker-toggle>
        <mat-datepicker #pickerFecha></mat-datepicker>
      </mat-form-field>
    </div>

    <!-- Comentario -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Comentario*</mat-label>
      <textarea matInput rows="3" formControlName="comentario"></textarea>
      <mat-error *ngIf="f['comentario'].hasError('required')">
        El comentario es obligatorio
      </mat-error>
    </mat-form-field>

    <!-- Pedido -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Pedido*</mat-label>
      <mat-select formControlName="idPedido">
        <mat-option
          *ngFor="let p of listaPedidos"
          [value]="p.idPedido"
        >
          Pedido #{{ p.idPedido }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="f['idPedido'].hasError('required')">
        Debes seleccionar un pedido
      </mat-error>
    </mat-form-field>

    <!-- Calificador -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Calificador*</mat-label>
      <mat-select formControlName="idCalificador">
        <mat-option
          *ngFor="let u of listaUsuarios"
          [value]="u.idUsuario"
        >
          {{ u.nombreUsuario }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="f['idCalificador'].hasError('required')">
        Debes seleccionar un calificador
      </mat-error>
    </mat-form-field>

    <!-- Calificado -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Calificado*</mat-label>
      <mat-select formControlName="idCalificado">
        <mat-option
          *ngFor="let u of listaUsuarios"
          [value]="u.idUsuario"
        >
          {{ u.nombreUsuario }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="f['idCalificado'].hasError('required')">
        Debes seleccionar un calificado
      </mat-error>
    </mat-form-field>

    <!-- Error cuando calificador == calificado -->
    <div
      class="form-error"
      *ngIf="form.hasError('mismoUsuarioCalificacion') && form.touched"
    >
      El calificador y el calificado no pueden ser el mismo usuario.
    </div>

    <div class="buttons">
      <button mat-raised-button color="primary" type="submit">
        {{ edicion ? 'Guardar cambios' : 'Guardar' }}
      </button>
      <button mat-raised-button type="button" (click)="cancelar()">
        Cancelar
      </button>
    </div>
  </form>
</div>